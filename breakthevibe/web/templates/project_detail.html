{% extends "base.html" %}
{% block title %}{{ project.name }} â€” BreakTheVibe{% endblock %}
{% block content %}
<div class="page-header">
    <h1>{{ project.name }}</h1>
    <span class="badge badge-{{ project.status }}">{{ project.status }}</span>
</div>
<p class="text-muted">{{ project.url }}</p>

<div class="action-bar">
    <button class="btn btn-primary"
            hx-post="/api/projects/{{ project.id }}/crawl"
            hx-swap="none">Crawl</button>
    <button class="btn btn-primary"
            hx-post="/api/projects/{{ project.id }}/generate"
            hx-swap="none">Generate Tests</button>
    <button class="btn btn-primary"
            hx-post="/api/projects/{{ project.id }}/run"
            hx-swap="none">Run Tests</button>
    <a href="/projects/{{ project.id }}/sitemap" class="btn">View Mind-Map</a>
    <a href="/projects/{{ project.id }}/rules" class="btn">Edit Rules</a>
</div>

<div class="tabs">
    <button class="tab active" data-tab="runs">Test Runs</button>
    <button class="tab" data-tab="sitemap">Site Map</button>
</div>

<div id="tab-runs" class="tab-content active">
    <div hx-get="/api/runs/latest/results" hx-trigger="load" hx-target="this">
        <p class="text-muted">Loading test runs...</p>
    </div>
</div>

<div id="tab-sitemap" class="tab-content" style="display:none">
    <div hx-get="/api/projects/{{ project.id }}/sitemap" hx-trigger="revealed" hx-target="this">
        <p class="text-muted">Loading sitemap...</p>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => { c.style.display = 'none'; c.classList.remove('active'); });
        tab.classList.add('active');
        const target = document.getElementById('tab-' + tab.dataset.tab);
        if (target) { target.style.display = 'block'; target.classList.add('active'); }
    });
});
</script>
{% endblock %}
